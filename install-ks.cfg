# Kickstart file automatically generated by anaconda.                                                              

#version=RHEL6
install       
lang en_US.UTF-8
keyboard fi     
firewall --service=ssh                                                                                                        
authconfig --enableshadow --passalgo=sha512 --enablefingerprint                                                               
selinux --disabled
timezone --utc Europe/Helsinki                                                                                                

services --enabled ypbind,ypserv,slurm,munge,nscd,nfs,named,ntpd,rdma,httpd,xinetd,dhcpd,portreserve,mysqld

url --url http://pulse.fgi.csc.fi/6.1/x86_64/os/
repo --name="Scientific Linux 6 - x86_64 - security updates"  --baseurl=http://pulse.fgi.csc.fi/6.1/x86_64/updates/security/ 
repo --name="FGI" --baseurl=http://pulse.fgi.csc.fi/fgirepo6/
repo --name="EPEL" --baseurl=http://ftp.funet.fi/pub/Linux/mirrors/redhat/epel/6/x86_64/

group --name admins

%post
#Disable yum autoupdate
sed -i /etc/sysconfig/yum-autoupdate -e 's/ENABLED="true"/ENABLED="false"/'

#fix resolving
grep search /etc/resolv.conf | sed -e "s/search\ /search\ local\ ib\ ilo\ /" >/tmp/resolv.conf
echo "nameserver 10.1.1.2" >>/tmp/resolv.conf
grep nameserver etc/resolv.conf >> /tmp/resolv.conf
cp -f /tmp/resolv.conf /etc

iface=`grep 'ONBOOT="yes"' /etc/sysconfig/network-scripts/ifcfg-eth* |head -n1 | cut -f1 -d ":"`
if [ $? -eq 0 ] && [ x"$iface" != "x" ] &&  [ -f $iface ] ; then
  echo 'PEERDNS="no"' >> $iface
fi


#limit ssh access
echo 'AllowGroups root admin' >> /etc/ssh/sshd_config
%end

%packages
@base
@console-internet
@core
@debugging
@directory-client
@hardware-monitoring
@java-platform
@large-systems
@misc-sl
@nfs-file-server
@network-server
@network-file-system-client
@performance
@perl-runtime
@scalable-file-systems
@server-platform
@infiniband
pax
oddjob
sgpio
certmonger
pam_krb5
krb5-workstation
nscd
pam_ldap
nss-pam-ldapd
bind-chroot
bind
dhcp
tftp-server
perl-DBD-SQLite
httpd
dhcp
ypserv
yp-tools
ypbind
bind
tigervnc
cluster-tools
cluster-profile
pdsh
pdsh-mod-machines
pdsh-rcmd-ssh
slurm
slurm-munge
slurm-sql
slurm-slurmdbd
mysql
mysql-server
xauth
fgi-release6
epel-release
cluster-firewall-install
%end
